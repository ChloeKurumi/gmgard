!function(){var e,t=window.Messenger;e=window.Messenger=function(){return e._call.apply(this,arguments)},window.Messenger.noConflict=function(){return window.Messenger=t,e}}(),window.Messenger._=function(){if(window._)return window._;var e=Array.prototype,t=Object.prototype,s=Function.prototype,n=(e.push,e.slice),r=(e.concat,t.toString),o=(t.hasOwnProperty,e.forEach),a=(e.map,e.reduce,e.reduceRight,e.filter),i=(e.every,e.some,e.indexOf,e.lastIndexOf,Array.isArray,Object.keys),l=s.bind,u={},c={},h=u.each=u.forEach=function(e,t,s){if(null!=e)if(o&&e.forEach===o)e.forEach(t,s);else if(e.length===+e.length){for(var n=0,r=e.length;n<r;n++)if(t.call(s,e[n],n,e)===c)return}else for(var i in e)if(u.has(e,i)&&t.call(s,e[i],i,e)===c)return};u.result=function(e,t){if(null==e)return null;var s=e[t];return u.isFunction(s)?s.call(e):s},u.once=function(e){var t,s=!1;return function(){return s||(s=!0,t=e.apply(this,arguments),e=null),t}};var p=0;return u.uniqueId=function(e){var t=++p+"";return e?e+t:t},u.filter=u.select=function(e,n,r){var i=[];return null==e?i:a&&e.filter===a?e.filter(n,r):(h(e,function(e,t,s){n.call(r,e,t,s)&&(i[i.length]=e)}),i)},h(["Arguments","Function","String","Number","Date","RegExp"],function(t){u["is"+t]=function(e){return r.call(e)=="[object "+t+"]"}}),u.defaults=function(s){return h(n.call(arguments,1),function(e){if(e)for(var t in e)null==s[t]&&(s[t]=e[t])}),s},u.extend=function(s){return h(n.call(arguments,1),function(e){if(e)for(var t in e)s[t]=e[t]}),s},u.keys=i||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var s in e)u.has(e,s)&&(t[t.length]=s);return t},u.bind=function(e,t){if(e.bind===l&&l)return l.apply(e,n.call(arguments,1));var s=n.call(arguments,2);return function(){return e.apply(t,s.concat(n.call(arguments)))}},u.isObject=function(e){return e===Object(e)},u}(),window.Messenger.Events=function(){if(window.Backbone&&Backbone.Events)return Backbone.Events;var l,e;return l=/\s+/,(e={on:function(e,t,s){return h(this,"on",e,[t,s])&&t&&(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:s,ctx:s||this})),this},once:function(e,t,s){if(!h(this,"once",e,[t,s])||!t)return this;var n=this,r=_.once(function(){n.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,s),this},off:function(e,t,s){var n,r,i,o,a,l,u,c;if(!this._events||!h(this,"off",e,[t,s]))return this;if(!e&&!t&&!s)return this._events={},this;for(a=0,l=(o=e?[e]:_.keys(this._events)).length;a<l;a++)if(e=o[a],n=this._events[e]){if(i=[],t||s)for(u=0,c=n.length;u<c;u++)r=n[u],(t&&t!==r.callback&&t!==r.callback._callback||s&&s!==r.context)&&i.push(r);this._events[e]=i}return this},trigger:function(e){if(!this._events)return this;var t=Array.prototype.slice.call(arguments,1);if(!h(this,"trigger",e,t))return this;var s=this._events[e],n=this._events.all;return s&&r(s,t),n&&r(n,arguments),this},listenTo:function(e,t,s){return((this._listeners||(this._listeners={}))[e._listenerId||(e._listenerId=_.uniqueId("l"))]=e).on(t,"object"==typeof t?this:s,this),this},stopListening:function(e,t,s){var n=this._listeners;if(n){if(e)e.off(t,"object"==typeof t?this:s,this),t||s||delete n[e._listenerId];else{for(var r in"object"==typeof t&&(s=this),n)n[r].off(t,s,this);this._listeners={}}return this}}}).bind=e.on,e.unbind=e.off,e;function h(e,t,s,n){if(!s)return 1;if("object"==typeof s)for(var r in s)e[t].apply(e,[r,s[r]].concat(n));else{if(!l.test(s))return 1;for(var i=s.split(l),o=0,a=i.length;o<a;o++)e[t].apply(e,[i[o]].concat(n))}}function r(e,t){var s,n=-1,r=e.length;switch(t.length){case 0:for(;++n<r;)(s=e[n]).callback.call(s.ctx);return;case 1:for(;++n<r;)(s=e[n]).callback.call(s.ctx,t[0]);return;case 2:for(;++n<r;)(s=e[n]).callback.call(s.ctx,t[0],t[1]);return;case 3:for(;++n<r;)(s=e[n]).callback.call(s.ctx,t[0],t[1],t[2]);return;default:for(;++n<r;)(s=e[n]).callback.apply(s.ctx,t)}}}(),function(){function e(e,t){for(var s in t)c.call(t,s)&&(e[s]=t[s]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var b,l,t,s,o,x,a,u,n,r,i,c={}.hasOwnProperty,M=[].slice,C=[].indexOf||function(e){for(var t=0,s=this.length;t<s;t++)if(t in this&&this[t]===e)return t;return-1};function h(e){b.extend(this,s),x.isObject(e)&&(e.el&&this.setElement(e.el),this.model=e.model),this.initialize.apply(this,arguments)}function p(){return p.__super__.constructor.apply(this,arguments)}function f(){return f.__super__.constructor.apply(this,arguments)}function d(){return d.__super__.constructor.apply(this,arguments)}function g(){return g.__super__.constructor.apply(this,arguments)}b=jQuery,x=null!=(n=window._)?n:window.Messenger._,s=null!=(r="undefined"!=typeof Backbone&&null!==Backbone?Backbone.Events:void 0)?r:window.Messenger.Events,h.prototype.setElement=function(e){return this.$el=b(e),this.el=this.$el[0]},h.prototype.delegateEvents=function(e){var t,s,n,r,i,o,a;if(e=e||x.result(this,"events")){for(n in this.undelegateEvents(),t=/^(\S+)\s*(.*)$/,a=[],e){if(i=e[n],x.isFunction(i)||(i=this[e[n]]),!i)throw new Error('Method "'+e[n]+'" does not exist');s=(r=n.match(t))[1],o=r[2],i=x.bind(i,this),s+=".delegateEvents"+this.cid,""===o?a.push(this.jqon(s,i)):a.push(this.jqon(s,o,i))}return a}},h.prototype.jqon=function(e,t,s){var n;return null!=this.$el.on?(n=this.$el).on.apply(n,arguments):(null==s&&(s=t,t=void 0),null!=t?this.$el.delegate(t,e,s):this.$el.bind(e,s))},h.prototype.jqoff=function(e){var t;return null!=this.$el.off?(t=this.$el).off.apply(t,arguments):(this.$el.undelegate(),this.$el.unbind(e))},h.prototype.undelegateEvents=function(){return this.jqoff(".delegateEvents"+this.cid)},h.prototype.remove=function(){return this.undelegateEvents(),this.$el.remove()},e(p,t=h),p.prototype.defaults={hideAfter:10,scroll:!0,closeButtonText:"&times;",escapeText:!1},p.prototype.initialize=function(e){return null==e&&(e={}),this.shown=!1,this.rendered=!1,this.messenger=e.messenger,this.options=b.extend({},this.options,e,this.defaults)},p.prototype.show=function(){var e;if(this.rendered||this.render(),this.$message.removeClass("messenger-hidden"),e=this.shown,this.shown=!0,!e)return this.trigger("show")},p.prototype.hide=function(){var e;if(this.rendered)return this.$message.addClass("messenger-hidden"),e=this.shown,this.shown=!1,e?this.trigger("hide"):void 0},p.prototype.cancel=function(){return this.hide()},p.prototype.update=function(e){var t,s=this;return x.isString(e)&&(e={message:e}),b.extend(this.options,e),this.lastUpdate=new Date,this.rendered=!1,this.events=null!=(t=this.options.events)?t:{},this.render(),this.actionsToEvents(),this.delegateEvents(),this.checkClickable(),this.options.hideAfter?(this.$message.addClass("messenger-will-hide-after"),null!=this._hideTimeout&&clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){return s.hide()},1e3*this.options.hideAfter)):this.$message.removeClass("messenger-will-hide-after"),this.options.hideOnNavigate?(this.$message.addClass("messenger-will-hide-on-navigate"),null!=("undefined"!=typeof Backbone&&null!==Backbone?Backbone.history:void 0)&&Backbone.history.on("route",function(){return s.hide()})):this.$message.removeClass("messenger-will-hide-on-navigate"),this.trigger("update",this)},p.prototype.scrollTo=function(){if(this.options.scroll)return b.scrollTo(this.$el,{duration:400,offset:{left:0,top:-20}})},p.prototype.timeSinceUpdate=function(){return this.lastUpdate?new Date-this.lastUpdate:null},p.prototype.actionsToEvents=function(){var e,s,t,n,r=this;for(s in n=[],t=this.options.actions)e=t[s],n.push(this.events['click [data-action="'+s+'"] a']=function(t){return function(e){return e.preventDefault(),e.stopPropagation(),r.trigger("action:"+s,t,e),t.action.call(r,e,r)}}(e));return n},p.prototype.checkClickable=function(){var e,t,s;for(e in s=[],t=this.events)t[e],"click"===e?s.push(this.$message.addClass("messenger-clickable")):s.push(void 0);return s},p.prototype.undelegateEvents=function(){var e;return p.__super__.undelegateEvents.apply(this,arguments),null!=(e=this.$message)?e.removeClass("messenger-clickable"):void 0},p.prototype.parseActions=function(){var e,t,s,n,r;for(n in t=[],r=this.options.actions)e=r[n],(s=b.extend({},e)).name=n,null==s.label&&(s.label=n),t.push(s);return t},p.prototype.template=function(e){var t,s,n,r,i,o,a,l,u,c,h=this;for(i=b("<div class='messenger-message message alert "+e.type+" message-"+e.type+" alert-"+e.type+"'>"),e.showCloseButton&&((n=b('<button type="button" class="messenger-close" data-dismiss="alert">')).html(e.closeButtonText),n.click(function(){var e;return h.cancel(),"function"==typeof(e=h.options).onClickClose&&e.onClickClose(),!0}),i.append(n)),o=e.escapeText?b('<div class="messenger-message-inner"></div>').text(e.message):b('<div class="messenger-message-inner">'+e.message+"</div>"),i.append(o),e.actions.length&&(s=b('<div class="messenger-actions">')),l=0,u=(c=e.actions).length;l<u;l++)a=c[l],(t=b("<span>")).attr("data-action",""+a.name),(r=b("<a>")).html(a.label),t.append(b('<span class="messenger-phrase">')),t.append(r),s.append(t);return i.append(s),i},p.prototype.render=function(){var e;if(!this.rendered)return this._hasSlot||(this.setElement(this.messenger._reserveMessageSlot(this)),this._hasSlot=!0),e=b.extend({},this.options,{actions:this.parseActions()}),this.$message=b(this.template(e)),this.$el.html(this.$message),this.shown=!0,this.rendered=!0,this.trigger("render")},e(f,a=p),f.prototype.initialize=function(){return f.__super__.initialize.apply(this,arguments),this._timers={}},f.prototype.cancel=function(){if(this.clearTimers(),this.hide(),null!=this._actionInstance&&null!=this._actionInstance.abort)return this._actionInstance.abort()},f.prototype.clearTimers=function(){var e,t,s,n;for(e in s=this._timers)t=s[e],clearTimeout(t);return this._timers={},null!=(n=this.$message)?n.removeClass("messenger-retry-soon messenger-retry-later"):void 0},f.prototype.render=function(){var e,t,s,n;for(t in f.__super__.render.apply(this,arguments),this.clearTimers(),n=[],s=this.options.actions)(e=s[t]).auto?n.push(this.startCountdown(t,e)):n.push(void 0);return n},f.prototype.renderPhrase=function(e,t){return e.phrase.replace("TIME",this.formatTime(t))},f.prototype.formatTime=function(e){var t;return t=function(e,t){return 1!==(e=Math.floor(e))&&(t+="s"),"in "+e+" "+t},0===Math.floor(e)?"now...":e<60?t(e,"second"):(e/=60)<60?t(e,"minute"):t(e/=60,"hour")},f.prototype.startCountdown=function(t,s){var n,r,i,e,o=this;if(null==this._timers[t])return n=this.$message.find("[data-action='"+t+"'] .messenger-phrase"),(r=null!=(e=s.delay)?e:3)<=10?(this.$message.removeClass("messenger-retry-later"),this.$message.addClass("messenger-retry-soon")):(this.$message.removeClass("messenger-retry-soon"),this.$message.addClass("messenger-retry-later")),(i=function(){var e;return n.text(o.renderPhrase(s,r)),0<r?(e=Math.min(r,1),r-=e,o._timers[t]=setTimeout(i,1e3*e)):(o.$message.removeClass("messenger-retry-soon messenger-retry-later"),delete o._timers[t],s.action())})()},o=f,e(d,t),d.prototype.tagName="ul",d.prototype.className="messenger",d.prototype.messageDefaults={type:"info"},d.prototype.initialize=function(e){return this.options=null!=e?e:{},this.history=[],this.messageDefaults=b.extend({},this.messageDefaults,this.options.messageDefaults)},d.prototype.render=function(){return this.updateMessageSlotClasses()},d.prototype.findById=function(t){return x.filter(this.history,function(e){return e.msg.options.id===t})},d.prototype._reserveMessageSlot=function(e){var t,s,n=this;for((t=b("<li>")).addClass("messenger-message-slot"),this.$el.prepend(t),this.history.push({msg:e,$slot:t}),this._enforceIdConstraint(e),e.on("update",function(){return n._enforceIdConstraint(e)});this.options.maxMessages&&this.history.length>this.options.maxMessages;)(s=this.history.shift()).msg.remove(),s.$slot.remove();return t},d.prototype._enforceIdConstraint=function(e){var t,s,n,r;if(null!=e.options.id)for(t=0,s=(r=this.history).length;t<s;t++)if(null!=(n=r[t].msg).options.id&&n.options.id===e.options.id&&e!==n){if(e.options.singleton)return void e.hide();n.hide()}},d.prototype.newMessage=function(e){var t,s,n,r,i=this;return null==e&&(e={}),e.messenger=this,a=null!=(s=null!=(n=Messenger.themes[null!=(r=e.theme)?r:this.options.theme])?n.Message:void 0)?s:o,(t=new a(e)).on("show",function(){if(e.scrollTo&&"fixed"!==i.$el.css("position"))return t.scrollTo()}),t.on("hide show render",this.updateMessageSlotClasses,this),t},d.prototype.updateMessageSlotClasses=function(){var e,t,s,n,r,i,o;for(e=!(n=!(t=null)),r=0,i=(o=this.history).length;r<i;r++)(s=o[r]).$slot.removeClass("messenger-first messenger-last messenger-shown"),s.msg.shown&&s.msg.rendered&&(s.$slot.addClass("messenger-shown"),e=!0,t=s,n&&(n=!1,s.$slot.addClass("messenger-first")));return null!=t&&t.$slot.addClass("messenger-last"),this.$el[(e?"remove":"add")+"Class"]("messenger-empty")},d.prototype.hideAll=function(){var e,t,s,n,r;for(r=[],t=0,s=(n=this.history).length;t<s;t++)e=n[t],r.push(e.msg.hide());return r},d.prototype.post=function(e){var t;return x.isString(e)&&(e={message:e}),e=b.extend(!0,{},this.messageDefaults,e),(t=this.newMessage(e)).update(e),t},e(g,u=d),g.prototype.doDefaults={progressMessage:null,successMessage:null,errorMessage:"Error connecting to the server.",showSuccessWithoutError:!0,retry:{auto:!0,allow:!0},action:b.ajax},g.prototype.hookBackboneAjax=function(s){var n,r=this;if(null==s&&(s={}),null==window.Backbone)throw"Expected Backbone to be defined";return s=x.defaults(s,{id:"BACKBONE_ACTION",errorMessage:!1,successMessage:"Request completed successfully.",showSuccessWithoutError:!1}),n=function(e){var t;return t=x.extend({},s,e.messenger),r.do(t,e)},null!=Backbone.ajax?(Backbone.ajax._withoutMessenger&&(Backbone.ajax=Backbone.ajax._withoutMessenger),null!=s.action&&s.action!==this.doDefaults.action||(s.action=Backbone.ajax),n._withoutMessenger=Backbone.ajax,Backbone.ajax=n):Backbone.sync=x.wrap(Backbone.sync,function(){var e,t,s;return s=arguments[0],e=2<=arguments.length?M.call(arguments,1):[],t=b.ajax,b.ajax=n,s.call.apply(s,[this].concat(M.call(e))),b.ajax=t})},g.prototype._getHandlerResponse=function(e){return!1!==e&&(!0===e||null==e||e)},g.prototype._parseEvents=function(e){var t,s,n,r,i,o;for(r in null==e&&(e={}),i={},e)n=e[r],s=r.indexOf(" "),o=r.substring(0,s),t=r.substring(s+1),null==i[o]&&(i[o]={}),i[o][t]=n;return i},g.prototype._normalizeResponse=function(){var e,t,s,n,r,i,o;for(e=r=n=null,i=0,o=(s=1<=arguments.length?M.call(arguments,0):[]).length;i<o;i++)"success"===(t=s[i])||"timeout"===t||"abort"===t?n=t:null!=(null!=t?t.readyState:void 0)&&null!=(null!=t?t.responseText:void 0)?r=t:x.isObject(t)&&(e=t);return[n,e,r]},g.prototype.do=g.prototype.run=function(){var d,g,m,e,t,y,v,_,s,n,w=this;if(y=arguments[0],_=arguments[1],d=3<=arguments.length?M.call(arguments,2):[],null==_&&(_={}),y=b.extend(!0,{},this.messageDefaults,this.doDefaults,null!=y?y:{}),g=this._parseEvents(y.events),m=function(e,t){var s;return s=y[e+"Message"],x.isFunction(s)?s.call(w,e,t):s},v=null!=(n=y.messageInstance)?n:this.newMessage(y),null!=y.id&&(v.options.id=y.id),null!=y.progressMessage&&v.update(b.extend({},y,{message:m("progress",null),type:"info"})),t={},x.each(["error","success"],function(p){var f;return f=_[p],t[p]=function(){var e,t,s,n,r,i,o,a,l,u,c,h;if(r=1<=arguments.length?M.call(arguments,0):[],n=(a=w._normalizeResponse.apply(w,r))[0],a[1],o=a[2],"success"===p&&null==v.errorCount&&!1===y.showSuccessWithoutError&&(y.successMessage=null),"error"===p&&(null==y.errorCount&&(y.errorCount=0),y.errorCount+=1),t=y.returnsPromise?r[0]:"function"==typeof f?f.apply(null,r):void 0,i=w._getHandlerResponse(t),x.isString(i)&&(i={message:i}),"error"!==p||0!==(null!=o?o.status:void 0)&&"abort"!==n){if(!("error"===p&&null!=y.ignoredErrorCodes&&(l=null!=o?o.status:void 0,0<=C.call(y.ignoredErrorCodes,l))))return e={message:m(p,o),type:p,events:null!=(u=g[p])?u:{},hideOnNavigate:"success"===p},"number"==typeof(null!=(c=(s=b.extend({},y,e,i)).retry)?c.allow:void 0)&&s.retry.allow--,"error"===p&&500<=(null!=o?o.status:void 0)&&null!=(h=s.retry)&&h.allow?(null==s.retry.delay&&(s.errorCount<4?s.retry.delay=10:s.retry.delay=300),s.hideAfter&&(null==s._hideAfter&&(s._hideAfter=s.hideAfter),s.hideAfter=s._hideAfter+s.retry.delay),s._retryActions=!0,s.actions={retry:{label:"retry now",phrase:"Retrying TIME",auto:s.retry.auto,delay:s.retry.delay,action:function(){return s.messageInstance=v,setTimeout(function(){return w.do.apply(w,[s,_].concat(M.call(d)))},0)}},cancel:{action:function(){return v.cancel()}}}):s._retryActions&&(delete s.actions.retry,delete s.actions.cancel,delete y._retryActions),v.update(s),i&&s.message?(Messenger(x.extend({},w.options,{instance:w})),v.show()):v.hide();v.hide()}else v.hide()}}),!y.returnsPromise)for(s in t)e=t[s],_[s],_[s]=e;return v._actionInstance=y.action.apply(y,[_].concat(M.call(d))),y.returnsPromise&&v._actionInstance.then(t.success,t.error),v},g.prototype.ajax=function(){var e,t;return t=arguments[0],e=2<=arguments.length?M.call(arguments,1):[],t.action=b.ajax,this.run.apply(this,[t].concat(M.call(e)))},g.prototype.expectPromise=function(e,t){return t=x.extend({},t,{action:e,returnsPromise:!0}),this.run(t)},g.prototype.error=function(e){return null==e&&(e={}),"string"==typeof e&&(e={message:e}),e.type="error",this.post(e)},g.prototype.info=function(e){return null==e&&(e={}),"string"==typeof e&&(e={message:e}),e.type="info",this.post(e)},g.prototype.success=function(e){return null==e&&(e={}),"string"==typeof e&&(e={message:e}),e.type="success",this.post(e)},l=g,b.fn.messenger=function(){var e,t,s,n,r,i,o,a;return s=arguments[0],t=2<=arguments.length?M.call(arguments,1):[],null==s&&(s={}),e=this,null!=s&&x.isString(s)?(a=e.data("messenger"))[s].apply(a,t):(r=s,null==e.data("messenger")&&(u=null!=(i=null!=(o=Messenger.themes[r.theme])?o.Messenger:void 0)?i:l,e.data("messenger",n=new u(b.extend({el:e},r))),n.render()),e.data("messenger"))},window.Messenger._call=function(e){var t,s,n,r,i,o,a,l,u,c;if(i={extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right",theme:"future",maxMessages:9,parentLocations:["body"]},null!=(e=b.extend(i,b._messengerDefaults,Messenger.options,e)).theme&&(e.extraClasses+=" messenger-theme-"+e.theme),o=e.instance||Messenger.instance,null==e.instance){for(s=null,u=0,c=(l=e.parentLocations).length;u<c;u++)if(a=l[u],(s=b(a)).length){n=a;break}o?b(o._location).is(b(n))||(o.$el.detach(),s.prepend(o.$el)):(t=b("<ul>"),s.prepend(t),(o=t.messenger(e))._location=n,Messenger.instance=o)}return null!=o._addedClasses&&o.$el.removeClass(o._addedClasses),o.$el.addClass(r=o.className+" "+e.extraClasses),o._addedClasses=r,o},b.extend(Messenger,{Message:o,Messenger:l,themes:null!=(i=Messenger.themes)?i:{}}),b.globalMessenger=window.Messenger=Messenger}.call(this),function(){var s,r={}.hasOwnProperty;function n(){return n.__super__.constructor.apply(this,arguments)}s=jQuery,function(e,t){for(var s in t)r.call(t,s)&&(e[s]=t[s]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,window.Messenger.Message),n.prototype.template=function(e){var t;return(t=n.__super__.template.apply(this,arguments)).append(s('<div class="messenger-spinner">\n    <span class="messenger-spinner-side messenger-spinner-side-left">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n    <span class="messenger-spinner-side messenger-spinner-side-right">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n</div>')),t},window.Messenger.themes.future={Message:n}}.call(this);