!function(v){"use strict";var i={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44,32,59],extraDelimiters:["，","；","　"],checkOnEnter:null,pushedListener:null,backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1},n={pushTag:function(t,a){var e,i,l,r,n,s,o,d,p,u,h,g=v(this),c=g.data("opts"),m=g.data("tlis"),f=g.data("tlid");!(t=T.trimTag(t,c.delimiterChars))||t.length<=0||(c.CapitalizeFirstLetter&&1<t.length&&(t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()),(!c.validator||a||c.validator(t))&&(0<c.maxTags&&m.length>=c.maxTags||(e=!1,i=jQuery.map(m,function(t){return t.toLowerCase()}),-1!==(n=v.inArray(t.toLowerCase(),i))&&(e=!0),e?v("#"+g.data("tm_rndid")+"_"+f[n]).stop().animate({backgroundColor:c.blinkBGColor_1},100).animate({backgroundColor:c.blinkBGColor_2},100).animate({backgroundColor:c.blinkBGColor_1},100).animate({backgroundColor:c.blinkBGColor_2},100).animate({backgroundColor:c.blinkBGColor_1},100).animate({backgroundColor:c.blinkBGColor_2},100):(a||g.trigger("tm:pushing",t),l=(l=Math.max.apply(null,f))===-1/0?0:l,r=++l,m.push(t),f.push(r),a||null!==c.AjaxPush&&-1===v.inArray(t,c.prefilled)&&v.post(c.AjaxPush,v.extend({tag:t},c.AjaxPushParameters)),s=g.data("tm_rndid")+"_"+r,o=g.data("tm_rndid")+"_Remover_"+r,d=v("<span/>").text(t).html(),p='<span class="'+T.tagClasses.call(g)+'" id="'+s+'">',p+="<span>"+d+"</span>",p+='<a href="#" class="tm-tag-remove" id="'+o+'" TagIdToRemove="'+r+'">',p+=c.tagCloseIcon+"</a></span> ",u=v(p),null!==c.tagsContainer?v(c.tagsContainer).append(u):1<r?(h=r-1,v("#"+g.data("tm_rndid")+"_"+h).after(u)):g.before(u),u.find("#"+o).on("click",g,function(t){t.preventDefault();var a=parseInt(v(this).attr("TagIdToRemove"));T.spliceTag.call(g,a,t.data)}),T.refreshHiddenTagList.call(g),a||g.trigger("tm:pushed",[t,o]),T.showOrHide.call(g)),g.val(""))))},popTag:function(){var t,a,e=v(this),i=e.data("tlis"),l=e.data("tlid");if(0<l.length){t=l.pop(),a=i[i.length-1],e.trigger("tm:popping",a);var r=i.pop();v("#"+e.data("tm_rndid")+"_"+t).remove(),T.refreshHiddenTagList.call(e),e.trigger("tm:popped",a),e.val(r)}},empty:function(){for(var t,a=v(this),e=a.data("tlis"),i=a.data("tlid");0<i.length;)t=i.pop(),e.pop(),v("#"+a.data("tm_rndid")+"_"+t).remove(),T.refreshHiddenTagList.call(a);a.trigger("tm:emptied",null),T.showOrHide.call(a)}},T={showOrHide:function(){var t=this,a=t.data("opts"),e=t.data("tlis");0<a.maxTags&&e.length<a.maxTags&&(t.show(),t.trigger("tm:show")),0<a.maxTags&&e.length>=a.maxTags&&(t.hide(),t.trigger("tm:hide"))},tagClasses:function(){var e,t=v(this),a=t.data("opts"),i=a.tagBaseClass,l=a.inputBaseClass;return e=i,t.attr("class")&&v.each(t.attr("class").split(" "),function(t,a){-1!==a.indexOf(l+"-")&&(e+=" "+i+a.substring(l.length))}),e+=a.tagClass?" "+a.tagClass:""},trimTag:function(t,a){var e;for(t=v.trim(t),e=0;e<t.length&&-1===v.inArray(t.charCodeAt(e),a);e++);return t.substring(0,e)},refreshHiddenTagList:function(){var t=v(this),a=t.data("tlis"),e=t.data("lhiddenTagList");e&&v(e).val(a.join(t.data("opts").baseDelimiter)).change(),t.trigger("tm:refresh",a.join(t.data("opts").baseDelimiter))},killEvent:function(t){t.cancelBubble=!0,t.returnValue=!1,t.stopPropagation(),t.preventDefault()},keyInArray:function(t,a){return-1!==v.inArray(t.which,a)},applyDelimiter:function(t){var a=v(this);n.pushTag.call(a,v(this).val()),t.preventDefault()},prefill:function(t){var e=v(this);v.each(t,function(t,a){n.pushTag.call(e,a,!0)})},pushAllTags:function(t,a){var e=this.data("opts"),i=this.data("tlis");e.AjaxPushAllTags&&("tm:pushed"===t.type&&-1!==v.inArray(a,e.prefilled)||v.post(e.AjaxPush,{tags:i.join(e.baseDelimiter)}))},spliceTag:function(t){var a,e=this,i=e.data("tlis"),l=e.data("tlid"),r=v.inArray(t,l);-1!==r&&(a=i[r],e.trigger("tm:splicing",a),v("#"+e.data("tm_rndid")+"_"+t).remove(),i.splice(r,1),l.splice(r,1),T.refreshHiddenTagList.call(e),e.trigger("tm:spliced",a)),T.showOrHide.call(e)},init:function(t){var a,e,r=v.extend({},i,t);r.hiddenTagListName=null===r.hiddenTagListName?"hidden-"+this.attr("name"):r.hiddenTagListName,a=r.delimeters||r.delimiters,e=[9,13,17,18,19,37,38,39,40],r.delimiterChars=[],r.delimiterKeys=[],v.each(a,function(t,a){-1!==v.inArray(a,e)?r.delimiterKeys.push(a):r.delimiterChars.push(a)}),r.baseDelimiter=String.fromCharCode(r.delimiterChars[0]||44),r.tagBaseClass="tm-tag",r.inputBaseClass="tm-input",v.isFunction(r.validator)||(r.validator=null),this.each(function(){var i=v(this),t="",a="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(i.data("tagManager"))return!1;i.data("tagManager",!0);for(var l=0;l<5;l++)a+=e.charAt(Math.floor(Math.random()*e.length));if(i.data("tm_rndid",a),i.data("opts",r).data("tlis",[]).data("tlid",[]),null===r.output?(t=v("<input/>",{type:"hidden",name:r.hiddenTagListName}),i.after(t),i.data("lhiddenTagList",t)):i.data("lhiddenTagList",v(r.output)),r.AjaxPushAllTags&&(i.on("tm:spliced",T.pushAllTags),i.on("tm:popped",T.pushAllTags),i.on("tm:pushed",T.pushAllTags)),r.pushedListener&&i.on("tm:pushed",r.pushedListener),i.on("focus keypress",function(t){v(this).popover&&v(this).popover("hide")}),r.isClearInputOnEsc&&i.on("keyup",function(t){27===t.which&&(v(this).val(""),T.killEvent(t))}),i.on("input",function(t){var a=v(this).val(),e=a.charAt(a.length-1);-1!==v.inArray(e,r.extraDelimiters)&&(v(this).val(a.slice(0,a.length-1)),T.applyDelimiter.call(i,t))}),i.on("keypress",function(t){T.keyInArray(t,r.delimiterChars)&&T.applyDelimiter.call(i,t)}),i.on("keydown",function(t){13===t.which&&(r.preventSubmitOnEnter&&T.killEvent(t),r.checkOnEnter&&r.checkOnEnter())||T.keyInArray(t,r.delimiterKeys)&&T.applyDelimiter.call(i,t)}),r.deleteTagsOnBackspace&&i.on("keydown",function(t){T.keyInArray(t,r.backspace)&&v(this).val().length<=0&&(n.popTag.call(i),T.killEvent(t))}),i.change(function(t){/webkit/.test(navigator.userAgent.toLowerCase())||i.focus(),T.killEvent(t)}),null!==r.prefilled)"object"==typeof r.prefilled?T.prefill.call(i,r.prefilled):"string"==typeof r.prefilled?T.prefill.call(i,r.prefilled.split(r.baseDelimiter)):"function"==typeof r.prefilled&&T.prefill.call(i,r.prefilled());else if(null!==r.output){if(v(r.output)&&v(r.output).val())v(r.output);T.prefill.call(i,v(r.output).val().split(r.baseDelimiter))}})}};v.fn.tagsManager=function(t){var a=v(this);return 0 in this?n[t]?n[t].apply(a,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(v.error("Method "+t+" does not exist."),!1):(T.init.apply(this,arguments),a):this}}(jQuery);